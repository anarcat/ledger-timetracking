How to plug time entries into (h)ledger
=======================================

This set of sample files shows how to organize timetracking with tools
like [ledgercli][] and [hledger][].

The [ledger file](ledger.lgr) file includes a [timelog](timelog). The
timelog is separate to make interaction with other tools,
e.g. `timeclock.el` or, in my case, [org-mode][]'s "clock" system with
[John Wiegley's org2tc script][] to export the clock entry to the
`timeclock` format.

The ledger file also includes transactions to issue a bill with the
timelog entries and receive a payment against the bill.

Looking at past entries
-----------------------

The resulting looks like this:

    $ ledger -f ledger.lgr bal
                     10€  assets:cash
                   1.00h  revenues:client
    --------------------
                   1.00h
                     10€

You see we have `10€` in cash, which is about right. However, the
ledger is unbalanced: there's a `10€` and a `1h` at the end... That is
because the time entries are "virtual" and not balanced against any
account. To ignore time entries, use the `--real` (`-R`) flag:

    $ ledger -f ledger.lgr bal -B -R
                     10€  assets:cash
                    -10€  revenues:client
    --------------------
                       0

Billing new entries
-------------------

To issue new bills, we will look at those unbalanced virtual entries.
They allow you to notice there is another hour of client work to
bill. You can issue a bill against that extra hour to complete your
billing with an entry like:

    2016/01/28 bill
        revenues:client  -1h @ 1€
        assets:receivables

Then you see something like this:

    $ ledger -f ledger.lgr bal
                     11€  assets
                     10€    cash
                      1€    receivables
    --------------------
                     11€


ie. congratulations, you billed all your hours. It is still
unbalanced, but you can fix that with `-R`:

    $ ledger -f ledger.lgr bal -B -R
                     11€  assets
                     10€    cash
                      1€    receivables
                    -11€  revenues:client
    --------------------
                       0

Notice how this shows a 1€ unpaid bill that we are waiting a payment
for, which is expected because we only issued the bill.

Issues
======

Unbalanced entries
------------------

The way transactions are imported, above, makes time entries show up
as unbalanced. It's confusing and annoying - there should be a way to
balance them with the right account, maybe the `revenues` account.

But then that would mean the `revenues` account would empty when we
bill, which is not correct: it should be debited with the size of the
bill, so that we have the running expenses showing up in balance
reports.

So in fact, unbalanced entries may be exactly the point of this.

HLedger bug
-----------

But this fails in hledger:

    $ hledger -f ledger.lgr bal
    creating default conversion rules file /home/anarcat/notes/tt-test/test.lgr.rules, edit this file for better results
    hledger: "/home/anarcat/notes/tt-test/test.lgr" (line 1, column 1):
    unexpected 'a'
    expecting journal transaction or directive or end of input
    1$ 

Of course, it chokes on the `apply account` directive from ledger. But
even using the regular `hledger` include fails:

    $ hledger -f hledger.lgr bal
    using conversion rules file /home/anarcat/notes/tt-test/test.hlgr.rules
    hledger: "/home/anarcat/notes/tt-test/test.hlgr" (line 2, column 1) in included file "test.timelog":
    "/home/anarcat/notes/tt-test/test.timelog" (line 1, column 1):
    unexpected 'i'
    expecting journal transaction or directive or end of input
    1$ 

I may be able to feed the timetracking data directly in the
`hledger.lgr` file, but
that's rather painful: i'd like to keep that messy file separate from
the main accounting.

[org-mode]: http://orgmode.org

Sources and inspiration
=======================

 * [John Wiegley's org2tc script][]
 * [Russel Adams' create invoice script][]
 * [Simon Michael's transaction sample][]
 * [Ledger-CLI timekeeping documentation][]
 * [hledger timelog documentation][]

 [John Wiegley's org2tc script]: https://github.com/jwiegley/org2tc
 [Russel Adams' create invoice script]: http://bazaar.launchpad.net/~rladams/+junk/LedgerInvoicingExample/view/head:/CreateInvoice.sh
 [Simon Michael's transaction sample]: https://gist.github.com/simonmichael/986a65106a9db1f8bd68
 [Ledger-CLI timekeeping documentation]: http://ledger-cli.org/3.0/doc/ledger3.html#Time-Keeping
 [hledger timelog documentation]: http://hledger.org/manual.html#timelog
